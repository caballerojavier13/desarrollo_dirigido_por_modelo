<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Modulo Persona</title>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/bootstrap-theme.css" />
        <script type="text/javascript" href="#{request.contextPath}/js/jquery.js" />
        <script type="text/javascript" href="#{request.contextPath}/js/bootstrap.js" />
        <style>
            body{
                background-image: url('#{request.contextPath}/img/background.png');
                background-repeat: repeat;
            }
        </style>
    </h:head>
    <h:body>

        <nav class="navbar navbar-default navbar-inverse navbar-static-top" role="navigation">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">

                    <a class="navbar-brand active">Desarrollo Dirigido por Modelos</a>
                </div>

            </div><!-- /.container-fluid -->
        </nav>
        <div id="body">
            <div style="width: 90%; margin-left: 5%;" id="tabla">

                <h:form style="margin-bottom: 20px">
                    <p:commandButton value="Nueva Persona" type="button" onclick="PF('newPersona').show();" />
                </h:form>
                <h:form>
                    <p:dataTable id="tabla"  var="persona" value="#{HomeView.personas}" rows="10"
                                 paginator="true"
                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="5,10,15">
                        <p:column headerText="Id">
                            <h:outputText value="#{persona.id}" />
                        </p:column>

                        <p:column headerText="Apellido">
                            <h:outputText value="#{persona.apellido}" />
                        </p:column>

                        <p:column headerText="Nombre" >
                            <h:outputText value="#{persona.nombre}" />
                        </p:column>

                        <p:column headerText="Edad">
                            <h:outputText value="#{persona.edad}" />
                        </p:column>
                        <p:column headerText="Operaciones">
                            <p:commandButton value="Editar" type="button" actionListener="#{ABMPersona.mostrarEdicion}" onclick="PF('newPersona').show();" style="color:blue; margin-right: 10px">

                            </p:commandButton>

                            <p:commandButton value="Eliminar" type="button" actionListener="#{ABMPersona.eliminar}" onclick="PF('newPersona').show();" style="color:blue; ">

                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </div>
            <p:dialog header="Crear Persona" widgetVar="newPersona" modal="true" width="40%">

                <h:form id="grid">
                    <p:ajaxStatus oncomplete="nuevaPersona()" />

                    <p:messages id="msgs" />

                    <ul style="width: 80%; margin-left: 10%; list-style: none;">
                        <li style="width: 100%; margin-bottom: 20px; margin-top: 20px;"> 
                            <h:outputLabel for="new_nombre" value="Nombre: " style="width: 20%"/>
                            <p:inputText id="new_nombre" style="width: 80%" value="#{ABMPersona.nombre}" required="true" requiredMessage="El campo nombre es requerido."/>
                        </li>
                        <li style="width: 100%; margin-bottom: 20px; margin-top: 20px;"> 
                            <h:outputLabel for="new_apellido" value="Apellido: " style="width: 20%"/>
                            <p:inputText id="new_apellido"  style="width: 80%" value="#{ABMPersona.apellido}" required="true" requiredMessage="El campo apellido es requerido."/>
                        </li>
                        <li style="width: 100%; margin-bottom: 20px; margin-top: 20px;"> 
                            <h:outputLabel for="new_edad" value="Edad: "  style="width: 20%"/>
                            <p:spinner id="new_edad" stepFactor="1" min="0"  value="#{ABMPersona.edad}" required="true" requiredMessage="El campo edad es requerido."/>
                        </li>
                    </ul>
                    <ul style="width: 100%; list-style: none; position: relative">
                        <li style="display: flex; width: 50%; position: relative">
                            <p:commandButton value="Cancelar" process="@form" update="grid" actionListener="#{ABMPersona.cancelar}" type="button" onclick="limpiarErrores()" style="position: relative; margin: 0 auto;"/> 
                        </li>
                        <li style="display: flex;width: 50%; position: absolute; top: 0; left: 50%;">
                            <p:commandButton value="Guardar" process="@form" update="grid" actionListener="#{ABMPersona.guardar}" onclick="limpiarErrores()" style="position: relative; margin: 0 auto;"/>
                        </li>
                    </ul>
                </h:form>

            </p:dialog>   
        </div>
        <script>
            function nuevaPersona() {
                var cantidadErrores = $("#grid .ui-messages div ul li").size();
                if (1 > parseInt(cantidadErrores)) {
                    resetFormularioNuevo();
                }
            }
            function limpiarErrores() {
                $("#grid .ui-messages ").empty();
                resetFormularioNuevo();
            }

            function resetFormularioNuevo() {
                $("#grid_new_nombre").val("");
                $("#grid_new_nombre").removeClass("ui-state-error");
                $("#grid_new_apellido").val("");
                $("#grid_new_apellido").removeClass("ui-state-error");
                $("#grid_new_edad").val("0");
                PF('newPersona').hide();
            }
        </script>    
    </h:body>
</html>

